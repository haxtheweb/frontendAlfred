# Chat Context & Storage Clarification\n\n## TL;DR\n**Documents are used for the current chat only. Nothing is persisted or stored on the server.**\n\n---\n\n## Data Flow\n\n### What Gets Stored (Temporarily in Memory)\n- **Client-side only (in browser memory):**\n  - Current chat messages (displayed to user)\n  - Last 10 conversation turns (for context window)\n  - Extracted document text (from uploaded files)\n  - URL context reference\n\n### What Does NOT Get Stored\n- ❌ No database storage\n- ❌ No file system storage on server\n- ❌ No persistent chat history\n- ❌ No user accounts/tracking\n- ❌ No document copies on server\n\n---\n\n## Detailed Breakdown\n\n### 1. File Upload Process\n\n**Current Implementation:**\n```javascript\n// File is read locally in the browser\nconst text = await extractTextFromFile(file);\n// Text stored in memory only\nchatState.context = text;\n```\n\n**What Happens:**\n1. User selects file (.pdf, .docx, .txt, .pptx)\n2. Browser reads file locally (client-side)\n3. Text is extracted in the browser\n4. Text stored in JavaScript memory (`chatState.context`)\n5. Text is passed to LLM with each message as context\n6. **Nothing is sent to server to be stored**\n7. When user closes browser or clears chat, data is gone\n\n**Special Case - DOCX Files:**\n- Currently sends to backend's `/upload-docx` endpoint\n- **Purpose:** Extract text content (not store it)\n- **Response:** Backend returns extracted text\n- **Result:** Text is only stored in memory, not persisted\n\n### 2. URL Context\n\n**What Happens:**\n1. User pastes a URL\n2. URL is validated locally\n3. URL reference stored in memory\n4. Passed to LLM as context with each message\n5. No fetch of URL content happens\n6. URL itself never sent to server to be stored\n\n### 3. Conversation History\n\n**What Gets Stored:**\n- Last 10 user-AI exchange pairs in browser memory\n- Used to maintain conversation context\n- Sent to LLM with each request to maintain memory\n- Discarded when:\n  - User clicks \"Clear Chat\"\n  - User closes browser tab\n  - Page is refreshed\n\n**What Does NOT Happen:**\n- No database entries created\n- No backend logging\n- No persistent chat history\n- No user tracking\n\n---\n\n## Technical Implementation\n\n### Browser-Side State (javascript)\n```javascript\nconst chatState = {\n    messages: [],                    // Displayed to user\n    context: null,                   // From uploaded doc/URL\n    contextType: null,               // Filename or URL\n    conversationHistory: []          // Last 10 turns for LLM\n};\n// ↑ ALL OF THIS IS VOLATILE (cleared on page refresh/close)\n```\n\n### Backend Processing\n\n**For DOCX Files (only file type requiring backend):**\n- Frontend sends file to `/upload-docx`\n- Backend extracts text temporarily\n- Text is returned to frontend\n- Backend does NOT store the file\n- Backend does NOT store the extracted text\n\n**For Chat Requests:**\n- Frontend sends: `{ query: \"...\", context: \"...\" }`\n- Backend processes and returns LLM response\n- Nothing is stored in backend database\n- Request details not logged for persistence\n\n---\n\n## Clear Chat Behavior\n\nWhen user clicks \"Clear Chat\":\n```javascript\nchatState.messages = [];              // ← cleared\nchatState.conversationHistory = [];   // ← cleared\nchatState.context = null;            // ← cleared\nchatState.contextType = null;        // ← cleared\n```\n\n**Result:** All data removed from memory. Cannot be recovered.\n\n---\n\n## Data Privacy\n\n✅ **What Users Should Know:**\n- Documents uploaded are **never stored**\n- Text is **never saved** on our servers\n- Conversations **don't persist** across sessions\n- **No account/login** needed\n- **No tracking** of chat history\n- Browser close = all data gone\n- Page refresh = all data gone\n\n❌ **What Users Should Be Aware Of:**\n- During single chat session, document text is in browser memory\n- While tab is open, data could theoretically be accessed via browser dev tools\n- Network requests may be visible in browser network tab\n- If DOCX, PDF, or PPTX files are uploaded, backend processes them briefly\n\n---\n\n## Future Considerations\n\nIf persistent storage is desired later:\n- Could implement optional \"Save Chat\" feature\n- Would require explicit user consent\n- Would need database schema for chat storage\n- Would need user authentication\n- Would require data retention/privacy policy\n\n**For now:** Everything is ephemeral and user-controlled.\n\n---\n\n## Summary Table\n\n| Item | Current Status | Storage | Persistence |\n|------|---|---|---|\n| Chat messages | Displayed to user | Browser memory | Session only |\n| Document text | Used for context | Browser memory | Session only |\n| URLs | Used as reference | Browser memory | Session only |\n| Conversation turns | Last 10 kept | Browser memory | Session only |\n| Server logs | None | N/A | N/A |\n| Database | Not used | N/A | N/A |\n| Files on disk | Not saved | N/A | N/A |\n\n---\n\n## Code Evidence\n\n**File upload only extracts locally:**\n```javascript\n// chat.js lines 213-218\nasync function handleFileUpload(file) {\n    const text = await extractTextFromFile(file);\n    chatState.context = text;      // ← stored in memory only\n    chatState.contextType = file.name;\n}\n```\n\n**Context passed to LLM (not backend storage):**\n```javascript\n// chat.js lines 55-57\nbody: JSON.stringify({\n    query: fullPrompt,\n    context: chatState.context || ''  // ← sent to LLM, not stored\n})\n```\n\n**Clear deletes everything:**\n```javascript\n// chat.js lines 317-320\nchatState.messages = [];\nchatState.conversationHistory = [];\nchatState.context = null;      // ← all deleted\nchatState.contextType = null;\n```\n"}}}